<?xml version="1.0" encoding="UTF-8"?>
<form:Form xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dync="http://www.chinacreator.com/platform/mvc/ui/dync" xmlns:form="http://www.chinacreator.com/platform/mvc/form" name="节点设置表单" sn="servicemanageactivityconfig" type="form">
  <form:control type="page/modal">
    <form:attributes source="page/modal">
      <dync:attribute default="" group="HTML" id="title" name="标题" value="节点设置">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
      <dync:attribute default="" group="事件" id="afterDataSourceLoad" name="数据源加载后" value="page_afterDataSourceLoad()">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
      <dync:attribute default="" group="事件" id="onload" name="页面加载完成" value="page_onload()">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
    </form:attributes>
  </form:control>
  <form:child xsi:type="form:Group" id="newGroupId" name="新分组">
    <form:control type="container/div">
      <form:attributes source="container/div">
        <dync:attribute default="false" group="HTML配置" id="pure" name="简单div" value="false">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="12" group="HTML配置" id="span" name="占位数" value="12">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="0" group="HTML配置" id="offset" name="偏移" value="0">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="" group="HTML配置" id="collapse" name="隐藏" value="">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="false" group="HTML配置" id="defaultCollapse" name="隐藏默认值" value="false">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="false" group="HTML配置" id="autoHeight" name="自动高度" value="true">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="" group="高级自定义" id="html" name="自定义HTML" value="">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="" group="高级自定义" id="cssClass" name="自定义class" value="">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="" group="高级自定义" id="style" name="自定义style" value="overflow:visible">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
      </form:attributes>
    </form:control>
    <form:child xsi:type="form:Group" id="newGroup" name="Tabs">
      <form:control type="container/tabs">
        <form:attributes source="container/tabs"/>
      </form:control>
      <form:child xsi:type="form:Group" id="newTab1" name="基本信息">
        <form:control type="container/tab">
          <form:attributes source="container/tab">
            <dync:attribute default="false" group="HTML配置" id="active" name="选中" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
        <form:child xsi:type="form:Field" binding="$model.activity_Name" id="newField" name="节点名称" customize="true">
          <form:control type="widget/text">
            <form:attributes source="widget/text"/>
          </form:control>
          <form:validation/>
        </form:child>
      </form:child>
      <form:child xsi:type="form:Group" id="newGroup6" name="操作">
        <form:control type="container/tab">
          <form:attributes source="container/tab"/>
        </form:control>
        <form:child xsi:type="form:Field" binding="$model.text" id="newField6" name="处理操作" customize="true">
          <form:control type="widget/span">
            <form:attributes source="widget/span">
              <dync:attribute default="6" group="基础属性" id="span" name="占位数" value="4">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="false" group="基础属性" id="showLable" name="显示lable" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="75" group="基础属性" id="lableWidth" name="lable宽度" value="150">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:validation/>
        </form:child>
        <form:child xsi:type="form:Group" id="newGroup7" name="简单容器(DIV)">
          <form:control type="container/div">
            <form:attributes source="container/div">
              <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="12" group="HTML配置" id="span" name="占位数" value="8">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:child xsi:type="form:Group" id="newGroup8" name="简单容器(DIV)">
            <form:control type="container/div">
              <form:attributes source="container/div">
                <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:child xsi:type="form:Field" binding="$model.allowReject" id="newField7" name="退回" customize="true">
              <form:control type="widget/checkbox">
                <form:attributes source="widget/checkbox">
                  <dync:attribute default="2" group="HTML设置" id="span" name="控件宽度" value="4">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                  <dync:attribute default="" group="事件设置" id="onChange" name="状态改变" value="newField7_onChange()">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                </form:attributes>
              </form:control>
              <form:validation/>
            </form:child>
            <form:child xsi:type="form:Field" binding="$model.entityactivityconfig.remark3" id="newField8" name="退回环节" customize="true">
              <form:control type="widget/select_simple">
                <form:attributes source="widget/select_simple">
                  <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="8">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                  <dync:attribute default="true" group="基本设置" id="show" name="可见" value="$model.allowReject">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                  <dync:attribute default="" group="下拉框设置" id="selectOptions" name="选项" value="$model.activities.result">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                </form:attributes>
              </form:control>
              <form:validation/>
            </form:child>
          </form:child>
          <form:child xsi:type="form:Group" id="newGroup9" name="简单容器(DIV)">
            <form:control type="container/div">
              <form:attributes source="container/div">
                <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:child xsi:type="form:Field" binding="$model.freeChoose" id="newField11" name="自由选择" customize="true">
              <form:control type="widget/checkbox">
                <form:attributes source="widget/checkbox">
                  <dync:attribute default="2" group="HTML设置" id="span" name="控件宽度" value="4">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                  <dync:attribute default="" group="事件设置" id="onChange" name="状态改变" value="newField11_onChange()">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                </form:attributes>
              </form:control>
              <form:validation/>
            </form:child>
            <form:child xsi:type="form:Field" binding="$model.entityactivityconfig.remark4" id="newField12" name="选择页面" customize="true">
              <form:control type="widget/text">
                <form:attributes source="widget/text">
                  <dync:attribute default="true" group="文本框设置" id="show" name="可见" value="$model.freeChoose">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                  <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="8">
                    <dync:render/>
                    <dync:children/>
                  </dync:attribute>
                </form:attributes>
              </form:control>
              <form:validation/>
            </form:child>
          </form:child>
        </form:child>
      </form:child>
      <form:child xsi:type="form:Group" id="newTab2" name="通知">
        <form:control type="container/tab">
          <form:attributes source="container/tab"/>
        </form:control>
        <form:child xsi:type="form:Field" id="newField4" name="分派/候选人通知：" customize="true">
          <form:control type="widget/span">
            <form:attributes source="widget/span">
              <dync:attribute default="6" group="基础属性" id="span" name="占位数" value="4">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="false" group="基础属性" id="showLable" name="显示lable" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="75" group="基础属性" id="lableWidth" name="lable宽度" value="150">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:validation/>
        </form:child>
        <form:child xsi:type="form:Group" id="newGroup2" name="简单容器(DIV)">
          <form:control type="container/div">
            <form:attributes source="container/div">
              <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="12" group="HTML配置" id="span" name="占位数" value="8">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:child xsi:type="form:Field" binding="$model.bind" id="assigneInformType" name="通知方式" customize="true">
            <form:control type="widget/checkbox_group">
              <form:attributes source="widget/checkbox_group">
                <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="12">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="checkboxOptions" name="选项" value="$model.a">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="optionId" name="值属性名" value="dictdataName">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="optionName" name="显示属性名" value="dictdataValue">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:validation/>
          </form:child>
        </form:child>
        <form:child xsi:type="form:Field" id="newField5" name="工单状态变化通知：" customize="true">
          <form:control type="widget/span">
            <form:attributes source="widget/span">
              <dync:attribute default="6" group="基础属性" id="span" name="占位数" value="4">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="false" group="基础属性" id="showLable" name="显示lable" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="75" group="基础属性" id="lableWidth" name="lable宽度" value="150">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:validation/>
        </form:child>
        <form:child xsi:type="form:Group" id="newGroup3" name="简单容器(DIV)">
          <form:control type="container/div">
            <form:attributes source="container/div">
              <dync:attribute default="12" group="HTML配置" id="span" name="占位数" value="8">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:child xsi:type="form:Field" binding="$model.observerStr" id="newField2" name="通知角色" customize="true">
            <form:control type="widget/text">
              <form:attributes source="widget/text">
                <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="12">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="false" group="输入框组" id="inputGroup" name="启用输入框组" value="true">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="iconSelect" group="输入框组" id="groupType" name="组类型" value="customIcon">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="fa-question" group="输入框组" id="customIcon" name="自定义图标" value="fa-users">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="输入框组" id="customEven" name="点击事件" value="newField2_customEven()">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:validation/>
          </form:child>
          <form:child xsi:type="form:Field" binding="$model.informScope" id="newField3" name="通知触发范围" customize="true">
            <form:control type="widget/radio_group">
              <form:attributes source="widget/radio_group">
                <dync:attribute default="" group="单选按钮组设置" id="radioOptions" name="选项" value="{&quot;关注此服务产品此环节&quot;:&quot;当前节点&quot;,&quot;关注此服务产品&quot;:&quot;服务产品&quot;}">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="12">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="false" group="单选按钮组设置" id="firstSelected" name="选中第一个" value="true">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="事件设置" id="clickEvent" name="选中事件" value="newField3_clickEvent(value)">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:validation/>
          </form:child>
          <form:child xsi:type="form:Field" binding="$model.bind1" id="concernInformType" name="通知方式" customize="true">
            <form:control type="widget/checkbox_group">
              <form:attributes source="widget/checkbox_group">
                <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="12">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="checkboxOptions" name="选项" value="$model.a">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="optionId" name="值属性名" value="dictdataName">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="optionName" name="显示属性名" value="dictdataValue">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:validation/>
          </form:child>
        </form:child>
      </form:child>
      <form:child xsi:type="form:Group" id="newGroup1" name="Tabs">
        <form:control type="container/tab">
          <form:attributes source="container/tab"/>
        </form:control>
        <form:child xsi:type="form:Field" id="newField1" name="显示tab页：" customize="true">
          <form:control type="widget/span">
            <form:attributes source="widget/span">
              <dync:attribute default="6" group="基础属性" id="span" name="占位数" value="4">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="false" group="基础属性" id="showLable" name="显示lable" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="75" group="基础属性" id="lableWidth" name="lable宽度" value="150">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:validation/>
        </form:child>
        <form:child xsi:type="form:Group" id="newGroup4" name="简单容器(DIV)">
          <form:control type="container/div">
            <form:attributes source="container/div">
              <dync:attribute default="false" group="HTML配置" id="nopadding" name="无内边距" value="true">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
              <dync:attribute default="12" group="HTML配置" id="span" name="占位数" value="8">
                <dync:render/>
                <dync:children/>
              </dync:attribute>
            </form:attributes>
          </form:control>
          <form:child xsi:type="form:Field" binding="$model.tabs" id="producttabs" name="" customize="true">
            <form:control type="widget/checkbox_group">
              <form:attributes source="widget/checkbox_group">
                <dync:attribute default="" group="单选按钮组设置" id="checkboxOptions" name="选项" value="$model.alltabs.result">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="optionId" name="值属性名" value="tabId">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="" group="单选按钮组设置" id="optionName" name="显示属性名" value="title">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="6" group="基本设置" id="span" name="占位数" value="12">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
                <dync:attribute default="75" group="基本设置" id="lableWidth" name="lable宽度" value="10">
                  <dync:render/>
                  <dync:children/>
                </dync:attribute>
              </form:attributes>
            </form:control>
            <form:validation/>
          </form:child>
        </form:child>
      </form:child>
    </form:child>
  </form:child>
  <form:child xsi:type="form:Group" id="newGroup5" name="对话框工具条">
    <form:control type="container/toolbar_modal_footer">
      <form:attributes source="container/toolbar_modal_footer"/>
    </form:control>
    <form:child xsi:type="form:Field" id="newField9" name="确定" customize="true">
      <form:control type="widget/button">
        <form:attributes source="widget/button">
          <dync:attribute default="" group="事件设置" id="click" name="点击事件" value="newField9_click($event)">
            <dync:render/>
            <dync:children/>
          </dync:attribute>
        </form:attributes>
      </form:control>
      <form:validation/>
    </form:child>
    <form:child xsi:type="form:Field" id="newField10" name="取消" customize="true">
      <form:control type="widget/button">
        <form:attributes source="widget/button">
          <dync:attribute default="" group="事件设置" id="click" name="点击事件" value="newField10_click($event)">
            <dync:render/>
            <dync:children/>
          </dync:attribute>
        </form:attributes>
      </form:control>
      <form:validation/>
    </form:child>
  </form:child>
  <form:datasources>
    <form:datasource xsi:type="form:Inputs"/>
    <form:datasource xsi:type="form:EntityDataSource" id="entityactivityconfig" name="单实体数据源" data="" entity="entity:com.chinacreator.c2.omp.service.manage.workflowcommon.Inform.ActivityConfig"/>
    <form:datasource xsi:type="form:LogicDataSource" id="dictdata" name="字典数据" logic="rule:com.chinacreator.c2.sysmgr.dict.getDictDataMap" sn="getDictDataMap">
      <form:param id="dictTypeNames" name="字典名称数组" value="['工作流_通知方式']"/>
    </form:datasource>
    <form:datasource xsi:type="form:TreeDataSource" id="tree" name="树型数据源" impl="com.chinacreator.c2.workflow.workflowManage.ds.CandidateChooseTreeContentProvider" type="custom"/>
    <form:datasource xsi:type="form:EntityDataSource" id="entity" name="单实体数据源" data="" entity="entity:com.chinacreator.c2.omp.service.manage.workflowcommon.Inform.UserConcernedConfig"/>
    <form:datasource xsi:type="form:LogicDataSource" id="alltabs" name="服务产品关联的tabs" logic="rule:com.chinacreator.c2.omp.service.manage.workflowcommon.Tabs.getAllTabsForProduct" sn="getalltabforproduct">
      <form:param id="productId" name="新输入参数" value="$params.moduleId"/>
    </form:datasource>
    <form:datasource xsi:type="form:LogicDataSource" id="activities" name="流程定义中的activities" logic="rule:com.chinacreator.c2.omp.service.manage.workflowcommon.getActivitiesFromProcDef" sn="getactivitiesfromprocdef">
      <form:param id="procDefId" name="新输入参数" value="$params.processDefId"/>
    </form:datasource>
  </form:datasources>
  <form:scripts>

newField1_onChange:function(){
/*	$model.entityactivityconfig.isPhonemsgInform = true;
	$model.entityactivityconfig.isEmailInform = true;
	$model.entityactivityconfig.informType = kcompglobal.workinformtype.phonemsg.value+&quot;,&quot;+kcompglobal.workinformtype.email.value;*/
},

page_afterDataSourceLoad:function(){
//	console.log(&quot;alltabs&quot;,$model.alltabs.result);
//	console.log(&quot;params&quot;,$params);
//	console.log(&quot;activities&quot;,$model.activities.result);
	$model.a = $model.dictdata.result['工作流_通知方式'];
//主键属性赋值 fo_r get but oracle didnt get it?//
//	$model.entityactivityconfig.Id = $params.activityId;
	//so oracle do this
	$model.entityactivityconfig.id = $params.activityId;
	
	$model.entityactivityconfig.$get()
		.then(function(a){
			console.log(&quot;activity config entity geted&quot;,a);
			if(angular.isUndefined($model.entityactivityconfig.id)){
				//maybe msyql do like this
//				$model.entityactivityconfig.Id = $params.activityId;
				// oracle must do like this
				$model.entityactivityconfig.id = $params.activityId;
			}

			if(angular.isUndefined($model.entityactivityconfig.informType)){
				
			}else{
//				console.log(&quot;activity config entity geted&quot;,$model.entityactivityconfig);
				var informs = $model.entityactivityconfig.informType.split(&quot;,&quot;);
				var options = $view.assigneInformType.getOptions();
				angular.forEach(options,function(v){				
					for(x in informs){
						if(informs[x]==v.value){
							v.checked = true;
						}
					}
				});					
			}
			if(!angular.isUndefined($model.entityactivityconfig.remark1)){						
				var tabs = $model.entityactivityconfig.remark1.split(&quot;,&quot;);
				var taboptions = $view.producttabs.getOptions();	
				angular.forEach(taboptions,function(v){				
					for(x in tabs){
						if(tabs[x]==v.value){
							v.checked = true;
						}
					}
				});
			}
			var returnindex = functions.has_action(&quot;return&quot;);
			if(returnindex==undefined){
				$model.allowReject = false;
			}else{
				$model.allowReject = true;
			}
			var returnindex = functions.has_action(&quot;freechoose&quot;);
			if(returnindex==undefined){
				$model.freeChoose = false;
			}else{
				$model.freeChoose = true;
			}		
		});
		
	var con = {};
	con.taskDefId = $params.activityId;
	con.processDefId = $params.moduleId;
	con.remark1 = &quot;activiyconfig&quot;;
	$http.post(&quot;ws/getuserconcernconfigforactivity&quot;,{u:con})
		.success(function(a){
			functions.do_view(a.result);
			$model.obseverId = $model.observerId;
			console.log(&quot;retruned a is &quot;,a);
		});
		

},

page_onload:function(){
	$model.activity_Name = $params.activity_name;
	/*有一个默认的处理页面*/
	$model.freechoose = true;
	$model.entityactivityconfig.remark4 = &quot;f/choosetaskhandler&quot;;
},
// save
newField9_click:function($event){
//infromType 字段取到，不同方式以逗号分隔
	var result;
	var options = $view.assigneInformType.getOptions();
	angular.forEach(options,function(v){	
		if(v.checked==true){
			if(angular.isUndefined(result)){
				result = v.value;
			}else{
				result = result+&quot;,&quot;+v.value;
			}
		}
	});	
	
	
	
	var concernInforms;
	var options = $view.concernInformType.getOptions();
	angular.forEach(options,function(v){	
		if(v.checked==true){
			if(angular.isUndefined(concernInforms)){
				concernInforms = v.value;
			}else{
				concernInforms = concernInforms+&quot;,&quot;+v.value;
			}
		}
	});	
	
	var selectedtabs;
	var taboptions = $view.producttabs.getOptions();	
	angular.forEach(taboptions,function(v){	
		if(v.checked==true){
			if(angular.isUndefined(selectedtabs)){
				selectedtabs = v.value;
			}else{
				selectedtabs = selectedtabs+&quot;,&quot;+v.value;
			}
		}
	});
//	console.log(&quot;selected tabs in front&quot;,selectedtabs);
	
	$model.entityactivityconfig.informType = angular.isUndefined(result)?&quot;&quot;:result;
	$model.entityactivityconfig.remark1 = angular.isUndefined(selectedtabs)?&quot;&quot;:selectedtabs;
	
	console.log(&quot;entity before save&quot;,$model.entityactivityconfig);
	//很奇怪的，如果有主键save就是更新操作，但是属性名id依然是插入操作，Id才会更新，然而get出来的实体属性名却是id
	//移植oracle后下面代码不正常。报错重复主键，奇怪啊
/*	if(!angular.isUndefined($model.entityactivityconfig.id)){
		$model.entityactivityconfig.Id = $model.entityactivityconfig.id;
	}
	$model.entityactivityconfig.$save(function(){
		Messenger.post({type:'success',message:'保存成功'});
		Modal.instance.close();
	});*/
	//oracle 调试
/*	if(!angular.isUndefined($model.entityactivityconfig.id)){
		$model.entityactivityconfig.id = $model.entityactivityconfig.id;
	}*/
	$model.entityactivityconfig.$save(function(){
		Messenger.post({type:'success',message:'保存成功'});
		Modal.instance.close();
	});
	
	var con = {};
	con.taskDefId = $params.activityId;
	con.processDefId = $params.moduleId;
	con.remark1 = &quot;activiyconfig&quot;;	
	con.informType = concernInforms;
	con.obseverId = $model.observerId;
	con.catogory = $model.catogory;
	con.remark2 = $model.observerStr;
	console.log(&quot;concern config before submit&quot;,con);
	$http.post(&quot;ws/operateuserconcernconfigforactivity&quot;,{action:$model.informScope,u:con});
},

newField10_click:function($event){
	Modal.instance.dismiss();
},
//选择人/组
newField2_customEven:function(){
	var selectedUserIds = $(&quot;#activity_performer_hidden&quot;).val();
	var selectedGroupIds = $(&quot;#activity_performer_hidden_group&quot;).val();
	Modal.open('f/chooseCandidate?selectedUserIds='+selectedUserIds+'&amp;selectedGroupIds='+selectedGroupIds
			,{selectedUserIds:selectedUserIds, selectedGroupIds:selectedGroupIds},function(data){
				console.log(&quot;choosed user group&quot;,data);
				if(data){
					if(data.userIds){
						var strId =&quot;&quot;;
						var str =&quot;&quot;;
						var userIdArray = functions.array_unique(data.userIds);
						var userNameArray = functions.array_unique(data.userNames);
						var kvJson = {};
						for(var i in userIdArray){
							kvJson[userIdArray[i]]=userNameArray[i];
						}		
						for(var i in userIdArray){
							strId+=userIdArray[i]+&quot;,&quot;;
							str+=kvJson[userIdArray[i]]+&quot;,&quot;;
						}
						if(strId!=&quot;&quot;){
							strId = strId.substring(0,strId.length-1);
						}
						$model.observerId = strId;
						$model.catogory = &quot;user&quot;;
						if(str!=&quot;&quot;){
							str = str.substring(0,str.length-1);
						}
					/*	$(&quot;#activity_performer&quot;).val(&quot;用户【&quot;+str+&quot;】&quot;);*/
						$model.observerStr = &quot;用户【&quot;+str+&quot;】&quot;;
/*						$(&quot;#activity_performer_hidden_group&quot;).val('');
						$(&quot;#activity_performer_hidden&quot;).val(strId);*/
						
					}
					if(data.groupIds){
						var str =&quot;&quot;;
						for(var i in data.groupNames){
							str+=data.groupNames[i]+&quot;,&quot;;
						}
						if(str!=&quot;&quot;){
							str = str.substring(0,str.length-1);
						}
/*						$(&quot;#activity_performer&quot;).val(&quot;组【&quot;+str+&quot;】&quot;);*/
						$model.observerStr = &quot;组【&quot;+str+&quot;】&quot;;
						var strId =&quot;&quot;;
						for(var i in data.groupIds){
							strId+=data.groupIds[i]+&quot;,&quot;;
						}
						if(strId!=&quot;&quot;){
							strId = strId.substring(0,strId.length-1);
						}
						$model.observerId = strId;
						$model.catogory = &quot;group&quot;;
/*						$(&quot;#activity_performer_hidden&quot;).val('');
						$(&quot;#activity_performer_hidden_group&quot;).val(strId);*/
					}
				}else{
/*					$(&quot;#activity_performer&quot;).val('');
					$(&quot;#activity_performer_hidden_group&quot;).val('');
					$(&quot;#activity_performer_hidden&quot;).val('');*/
				}			
			});
},

newField3_clickEvent:function(value){
	if(value==&quot;关注此服务产品此环节&quot;){
		var con = {};
		con.taskDefId = $params.activityId;
		con.processDefId = $params.moduleId;
		con.remark1 = &quot;activiyconfig&quot;;
		$http.post(&quot;ws/getuserconcernconfigforactivity&quot;,{u:con})
			.success(function(a){
				functions.do_view(a.result);
				$model.obseverId = $model.observerId;
				console.log(&quot;retruned a is &quot;,a);
			});		
	}else if(value==&quot;关注此服务产品&quot;){
		var con = {};
		con.processDefId = $params.moduleId;
		con.remark1 = &quot;activiyconfig&quot;;
		$http.post(&quot;ws/getuserconcernconfigforactivity&quot;,{u:con})
			.success(function(a){
				functions.do_view(a.result);
				$model.obseverId = $model.observerId;
				console.log(&quot;retruned a is &quot;,a);
			});
	}

},
do_view:function(a){
//	console.log(&quot;do view in&quot;,a);
	var observerStr = a.remark2;
	$model.observerStr = observerStr;
	if(!angular.isUndefined(a.informType)){
		var informs = a.informType.split(&quot;,&quot;);
		var options = $view.concernInformType.getOptions();
		angular.forEach(options,function(v){
			v.checked = false;				
			for(x in informs){
				if(informs[x]==v.value){
					v.checked = true;
				}
			}
		});	
	}else{
		var options = $view.concernInformType.getOptions();
		angular.forEach(options,function(v){
			v.checked = false;				
		});
	}

},
add_action:function(action){
	if($model.entityactivityconfig.remark2==undefined||$model.entityactivityconfig.remark2==&quot;&quot;){
		$model.entityactivityconfig.remark2 = action;
	}else{
		var index = this.has_action(action);
		if(index==undefined){
			$model.entityactivityconfig.remark2 = $model.entityactivityconfig.remark2+&quot;,&quot;+action;
		}	
	}
},
has_action:function(action){
	var a = $model.entityactivityconfig.remark2.split(&quot;,&quot;);
	var index = undefined;
	for(var i=0;i&lt;a.length;i++){
		if(a[i] == action){
			index = i;
			break;
		}
	}
	return index;
},
del_action:function(action){
	if($model.entityactivityconfig.remark2!=undefined){
		var a = $model.entityactivityconfig.remark2.split(&quot;,&quot;);
		var index = undefined;
		for(var i=0;i&lt;a.length;i++){
			if(a[i] == action){
				index = i;
				break;
			}
		}
		if(index!=undefined){
			a.splice(index,1);
			$model.entityactivityconfig.remark2 = a.join(&quot;,&quot;)
		}					
	}
},
newField7_onChange:function(){
	if($model.allowReject){
		this.add_action(&quot;return&quot;);
	}else{
		$model.entityactivityconfig.remark3 = undefined;
		this.del_action(&quot;return&quot;);
	}
	console.log(&quot;actions&quot;,$model.entityactivityconfig.remark2);
},

newField11_onChange:function(){
	if($model.freeChoose){
		this.add_action(&quot;freechoose&quot;);
	}else{
		$model.entityactivityconfig.remark4 = &quot;f/choosetaskhandler&quot;;
		this.del_action(&quot;freechoose&quot;);
	}	
	console.log(&quot;actions&quot;,$model.entityactivityconfig.remark2);
}</form:scripts>
  <form:htmls>
</form:htmls>
</form:Form>
